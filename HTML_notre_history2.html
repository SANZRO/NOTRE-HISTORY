<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Trello — Races, Talent, Classe</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

  <style>
    :root{
      --cloud-speed: 0.33;
    }
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      color: #fff;
      overflow-x: hidden;
      background: radial-gradient(circle at 50% 20%, #0b1a2f, #000015);
    }

    /* ==== Ciel étoilé simple ==== */
    #bgStars {
      position: fixed; inset: 0; z-index: 0; overflow: hidden;
      background: radial-gradient(circle at 50% 20%, #ffffff11, #000015);
    }
    .star {
      position: absolute; background: white; border-radius: 50%;
      opacity: 1; animation: twinkle 1.5s ease-in-out infinite;
      filter: drop-shadow(0 0 2px rgba(255,255,255,.9));
    }
    @keyframes twinkle { 0%, 100% { opacity: 0.2; } 50% { opacity: 2; } }
   #meteorOne {
      position: absolute; width: 2px; height: 120px;
      background: linear-gradient(to bottom, #fff, transparent);
      top: 10vh; left: -10vw; opacity: 0.8;
      animation: meteor 3s linear infinite;
    }
    /*@keyframes meteor {
      0%   { transform: translate(0, 0) rotate(120deg); opacity: 0; }
      10%  { opacity: 1; }
      70%  { opacity: 1; }
      100% { transform: translate(120vw, 80vh) rotate(90deg); opacity: 0; }
    }

    /* ==== En-tête ==== */
    header {
      position: relative; z-index: 10;
      display: flex; justify-content: space-between; align-items: center;
      padding: 16px 18px;
      background: rgba(0,0,0,0.35);
      backdrop-filter: blur(2px);
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    header h1 { margin: 0; font-size: 18px; }
    .btn {
      padding: 8px 14px; border: none; border-radius: 6px;
      cursor: pointer; color: #0d1b2a; background: rgba(33,150,243,0.35);
      border: 1px solid rgba(33,150,243,0.4);
      transition: background .2s ease, border-color .2s ease;
    }
    .btn:hover { background: rgba(33,150,243,0.5); border-color: rgba(33,150,243,0.6); }

    /* ==== Trello ==== */
    main {
      position: relative; z-index: 10;
      max-width: 1100px; margin: 30px auto; padding: 0 16px;
    }
    #trelloBoard {
      margin-top: 10px; padding: 20px; background: rgba(255,255,255,0.08);
      border-radius: 10px;
    }
    #trelloColumns { display: flex; gap: 20px; flex-wrap: wrap; }
    .trello-column {
      flex: 1; min-width: 280px; background: rgba(0,0,0,0.35);
      padding: 15px; border-radius: 10px; min-height: 260px;
    }
    .trello-column h2 { margin: 0 0 6px; text-align: center; }
    .descRow {
      display: flex; gap: 8px; align-items: center; justify-content: space-between;
      margin-bottom: 8px;
    }
    .toggleBtn {
      padding: 8px 10px; border: none; border-radius: 6px; background: #2196f3;
      color: #fff; cursor: pointer;
    }
    .hidden-content {
      display: none;
      width: 100%;
      min-height: 100px;
      border-radius: 6px;
      padding: 8px;
      color: #000;
      background: rgba(255,255,255,0.95);
      border: 1px solid rgba(255,255,255,0.6);
      margin-bottom: 8px;
    }

    .trello-list {
      min-height: 200px; padding: 10px; border-radius: 8px;
      border: 1px dashed rgba(255,255,255,0.3);
      background: rgba(0,0,0,0.15);
    }
    .trello-card {
      background: rgba(255,255,255,0.95); color: #000; padding: 8px;
      margin-bottom: 8px; border-radius: 6px; cursor: grab; word-wrap: break-word;
      transition: transform .12s ease, box-shadow .12s ease;
    }
    .trello-card:hover {
      transform: translateY(-1px);
      box-shadow: 0 2px 10px rgba(0,0,0,0.25);
    }
    .trello-card:active { cursor: grabbing; }

    .actionsRow {
      display: flex; gap: 8px; margin-top: 10px;
    }
    .addCardBtn {
      flex: 1;
      padding: 8px; border: none; border-radius: 6px; background: #4caf50; color: #fff; cursor: pointer;
    }
    .addCardBtn:hover { background: #43a047; }

    /* ==== Modal d’information (pour Beastman et autres fiches) ==== */
    /* Overlay semi-transparent plein écran */
    #infoModalOverlay {
      position: fixed; inset: 0; z-index: 1000;
      background: rgba(0,0,0,0.55);
      display: none; /* visible via JS */
      align-items: center; justify-content: center;
      padding: 16px;
    }
    /* Panneau central */
    #infoModalPanel {
      max-width: 720px; width: 100%;
      background: #0d1b2a;
      border: 1px solid rgba(255,255,255,0.15);
      border-radius: 10px;
      color: #fff;
      box-shadow: 0 8px 24px rgba(0,0,0,0.45);
    }
    .modalHeader {
      display: flex; align-items: center; justify-content: space-between;
      padding: 12px 16px; border-bottom: 1px solid rgba(255,255,255,0.12);
      background: rgba(255,255,255,0.05);
      border-top-left-radius: 10px; border-top-right-radius: 10px;
    }
    .modalHeader h3 { margin: 0; font-size: 16px; }
    .closeModalBtn {
      border: none; border-radius: 6px; padding: 8px 10px; cursor: pointer;
      background: #e53935; color: #fff;
    }
    .closeModalBtn:hover { background: #d32f2f; }
    .modalBody {
      padding: 14px 16px;
    }
    .modalBody h4 {
      margin: 12px 0 6px; font-size: 14px; color: #90caf9;
    }
    .modalBody p, .modalBody ul, .modalBody pre {
      margin: 6px 0; color: #e3f2fd;
    }
    .mono {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 6px;
      padding: 8px;
      white-space: pre-wrap;
    }
  </style>



<style>
/*=== Forcer une seule ligne + scroll horizontal sur le board === */
#trelloBoard {
  overflow-x: auto;    /* active le scroll horizontal dans le board */
  overflow-y: hidden;
  padding-bottom: 8px; /* petit espace pour la barre de scroll */
}

/* Les colonnes restent sur UNE SEULE LIGNE */
#trelloColumns {
  display: flex;
  flex-wrap: nowrap;   
  gap: 20px;
  width: max-content;  /* la largeur suit le contenu -> permet le scroll horizontal */
}

/* Largeur fixe par colonne (ajuste 320px si besoin) */
.trello-column {
  flex: 0 0 320px;     
  min-width: 320px;    
}

/* (Optionnel) compact sur petit écran */
@media (max-width: 600px) {
  .trello-column {
    flex-basis: 280px;
    min-width: 280px;
  }
} 
</style>
</head>

</head>
<body>
  <!-- Fond étoilé -->
  <div id="bgStars" aria-hidden="true">
    <div id="meteorOne"></div>
  </div>

  <header>
    <h1>Trello — Races, Talent, Classe, trait, magie, arme</h1>
    <button class="btn" id="backBtn">⟵ Retour à l’accueil</button>
  </header>

  <main>
    <section id="trelloBoard" aria-label="Tableau Trello des catégories">
      <div id="trelloColumns">

        <!-- ===== Races ===== -->
        <div class="trello-column" data-column="races">
          <h2>Races</h2>
          <div class="descRow">
            <button class="toggleBtn" type="button">Afficher / Masquer</button>
          </div>
          <textarea class="hidden-content" placeholder="Décris ici les races..."></textarea>

          <!-- Liste des cartes -->
          <div class="trello-list" aria-label="Liste de cartes — Races"></div>

          <!-- Actions : on garde uniquement l’ajout (suppression retirée) -->
          <div class="actionsRow">
            <button type="button" class="addCardBtn">+ Ajouter une carte</button>
          </div>
        </div>

        <!-- ===== Talent ===== -->
        <div class="trello-column" data-column="talent">
          <h2>Talent</h2>
          <div class="descRow">
            <button class="toggleBtn" type="button">Afficher / Masquer</button>
          </div>
          <textarea class="hidden-content" placeholder="Décris ici les talents..."></textarea>
          <div class="trello-list" aria-label="Liste de cartes — Talent"></div>
          <div class="actionsRow">
            <button type="button" class="addCardBtn">+ Ajouter une carte</button>
          </div>
        </div>

        <!-- ===== Classe ===== -->
        <div class="trello-column" data-column="classe">
          <h2>Classe</h2>
          <div class="descRow">
            <button class="toggleBtn" type="button">Afficher / Masquer</button>
          </div>
          <textarea class="hidden-content" placeholder="Décris ici les classes..."></textarea>
          <div class="trello-list" aria-label="Liste de cartes — Classe"></div>
          <div class="actionsRow">
            <button type="button" class="addCardBtn">+ Ajouter une carte</button>
          </div>
        </div>


<!-- ===== TRAIT ===== -->
<div class="trello-column" data-column="trait">
  <h2>Trait</h2>
  <div class="descRow">
    <button class="toggleBtn" type="button">Afficher / Masquer</button>
  </div>
  <textarea class="hidden-content" placeholder="Décris ici les traits..."></textarea>
  <div class="trello-list" aria-label="Liste de cartes — Trait"></div>
  <div class="actionsRow">
    <button type="button" class="addCardBtn">+ Ajouter une carte</button>
  </div>
</div>

<!-- ===== MAGIE ===== -->
<div class="trello-column" data-column="magie">
  <h2>Magie</h2>
  <div class="descRow">
    <button class="toggleBtn" type="button">Afficher / Masquer</button>
  </div>
  <textarea class="hidden-content" placeholder="Décris ici les magies..."></textarea>
  <div class="trello-list" aria-label="Liste de cartes — Magie"></div>
  <div class="actionsRow">
    <button type="button" class="addCardBtn">+ Ajouter une carte</button>
  </div>
</div>

<!-- ===== ARME ===== -->
<div class="trello-column" data-column="arme">
  <h2>Arme</h2>
  <div class="descRow">
    <button class="toggleBtn" type="button">Afficher / Masquer</button>
  </div>
  <textarea class="hidden-content" placeholder="Décris ici les armes..."></textarea>
  <div class="trello-list" aria-label="Liste de cartes — Arme"></div>
  <div class="actionsRow">
    <button type="button" class="addCardBtn">+ Ajouter une carte</button>
  </div>
</div>
``


  <!-- ===== Modal générique d’info (utilisé pour Beastman et futures fiches) ===== -->
  <div id="infoModalOverlay" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <div id="infoModalPanel">
      <div class="modalHeader">
        <h3 id="modalTitle">Fiche</h3>
        <button type="button" class="closeModalBtn" id="closeModalBtn">Fermer</button>
      </div>
      <div class="modalBody" id="modalBody">
        <!-- Contenu injecté dynamiquement via JS -->
      </div>
    </div>
  </div>

  <script>
    /* =========================================================
       1) FOND ÉTOILÉ
       - Tu peux changer le nombre d’étoiles dans generateStars(160)
       ========================================================= */
    const bgStars = document.getElementById('bgStars');
    function generateStars(count = 140) {
      bgStars.querySelectorAll('.star').forEach(s => s.remove());
      for (let i = 0; i < count; i++) {
        const star = document.createElement('div');
        star.className = 'star';
        const size = Math.random() < 0.85 ? 4 : 6;
        star.style.width  = size + 'px';
        star.style.height = size + 'px';
        star.style.left   = (Math.random() * 100) + 'vw';
        star.style.top    = (Math.random() * 100) + 'vh';
        star.style.animationDuration = (1.6 + Math.random() * 2.4) + 's';
        star.style.animationDelay    = (Math.random() * 2) + 's';
        bgStars.appendChild(star);
      }
      const meteor = document.getElementById('meteorOne');
      if (meteor) meteor.style.animationDelay = (Math.random() * 3) + 's';
    }
    document.addEventListener('DOMContentLoaded', () => generateStars(160));

    /* =========================================================
       2) PERSISTANCE (localStorage)
       - Tout est stocké dans STORAGE_KEY (cartes + descriptions)
       ========================================================= */
    const STORAGE_KEY = 'trello_categories_v1'; // namespace distinct

    function loadState() {
      try { return JSON.parse(localStorage.getItem(STORAGE_KEY)) || {}; }
      catch { return {}; }
    }
    function saveState(state) {
      try { localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); }
      catch (e) { /* quota ou navigation privée */ }
    }

    // Modèle de state :
    // { races: { desc: '...', cards: ['a','b'] }, talent: {...}, classe: {...} }
    let appState = {
      races:  { desc: '', cards: [] },
      talent: { desc: '', cards: [] },
      classe: { desc: '', cards: [] },
      trait:  { desc: '', cards: [] },
      magie:  { desc: '', cards: [] },
      arme:  { desc: '', cards: [] },
      ...loadState()
    };

    


 /*===== TALENTS PAR DÉFAUT =====*/
const DEFAULT_TALENT = [
  'Force ⚪ — Talents Pool'
];

if (!Array.isArray(appState.talent.cards)) appState.talent.cards = [];
DEFAULT_TALENT.forEach(t => {
  if (!appState.talent.cards.includes(t)) {
    appState.talent.cards.push(t);
  }
});
saveState(appState);



    /* =========================================================
       4) TRELLO LOGIQUE
       - Drag & Drop OK
       - Ajout de carte OK
       - Suppression volontairement retirée (tu avais demandé)
       ========================================================= */
    let draggedCard = null;

    /* ---------------------------------------------------------
       UTILS : normaliser une chaine pour comparaison
       - évite les soucis avec accents ("Géant" vs "geant")
       - tu peux réutiliser pour d'autres fonctionnalités
       --------------------------------------------------------- */
    function normalizeText(s) {
      return (s || '')
        .toString()
        .trim()
        .toLowerCase()
        .normalize('NFD')
        .replace(/[\u0300-\u036f]/g, ''); // retire accents
    }

    /* ---------------------------------------------------------
       createCard(text)
       - crée une carte Trello + events (drag + click fiche)
       IMPORTANT :
       - Toute la logique click doit être ICI (pas en dehors)
       --------------------------------------------------------- */
    function createCard(text) {
      const card = document.createElement('div');
      card.className = 'trello-card';
      card.textContent = text;
      card.draggable = true;

      // Drag & Drop
      card.addEventListener('dragstart', () => {
        draggedCard = card;
        card.style.opacity = '0.5';
      });
      card.addEventListener('dragend', () => {
        draggedCard = null;
        card.style.opacity = '1';
      });

      /* -------------------------------------------------------
         CLICK : ouvrir la fiche si la carte correspond à une race
         - Tu peux ajouter d'autres conditions ici
         - Exemple :
           if (key.includes('elf')) openElfModal();
         ------------------------------------------------------- */
     


/* Helper : tente d’ouvrir un talent si le texte correspond à une entrée */
function tryOpenTalentByKey(keyNorm) {
  for (const token in TALENT_ROUTES) {
    if (keyNorm.includes(token)) {
      TALENT_ROUTEStoken;  // <-- correction ici
      return true;
    }
  }
  return false;
}


    /* ---------------------------------------------------------
       syncFromDOMToState(colKey)
       - lit les cartes + description depuis le DOM
       - met à jour appState + localStorage
       --------------------------------------------------------- */
    function syncFromDOMToState(colKey) {
      const colEl = document.querySelector(`.trello-column[data-column="${colKey}"]`);
      const listEl = colEl.querySelector('.trello-list');
      const cards = Array.from(listEl.querySelectorAll('.trello-card')).map(c => c.textContent);
      const desc = colEl.querySelector('.hidden-content').value || '';
      appState[colKey] = { desc, cards };
      saveState(appState);
    }

    /* ---------------------------------------------------------
       renderState()
       - reconstruit toutes les colonnes à partir de appState
       --------------------------------------------------------- */
    function renderState() {
      ['races', 'talent', 'classe', 'trait', 'magie', 'arme'].forEach(colKey => {
        const colEl = document.querySelector(`.trello-column[data-column="${colKey}"]`);
        const listEl = colEl.querySelector('.trello-list');
        const area   = colEl.querySelector('.hidden-content');

        // description
        area.value = appState[colKey]?.desc || '';

        // cartes
        listEl.innerHTML = '';
        (appState[colKey]?.cards || []).forEach(cardText => {
          listEl.appendChild(createCard(cardText));
        });
      });
    }

    // Initialiser l’UI
    renderState();

    /* =========================================================
       5) AJOUT DE CARTES (bouton vert)
       - Ajoute une carte dans la colonne ciblée
       - Evite les doublons exacts dans la même colonne
       ========================================================= */
    document.querySelectorAll('.addCardBtn').forEach(btn => {
      btn.addEventListener('click', () => {
        const colEl = btn.closest('.trello-column');
        const colKey = colEl.dataset.column;

        const text = prompt('Nom de la carte :');
        if (!text) return;

        // éviter doublons exacts dans la même colonne
        const listEl = colEl.querySelector('.trello-list');
        const existing = Array.from(listEl.querySelectorAll('.trello-card')).map(c => c.textContent);
        if (existing.includes(text)) {
          alert('Cette carte existe déjà dans cette colonne.');
          return;
        }

        listEl.appendChild(createCard(text));
        syncFromDOMToState(colKey);
      });
    });

    /* =========================================================
       6) DRAG & DROP ENTRE LISTES
       - On met à jour la colonne source + destination
       ========================================================= */
    document.querySelectorAll('.trello-list').forEach(list => {
      list.addEventListener('dragover', e => e.preventDefault());
      list.addEventListener('drop', () => {
        if (draggedCard) {
          const fromCol = draggedCard.closest('.trello-column').dataset.column;
          list.appendChild(draggedCard);
          const toCol = list.closest('.trello-column').dataset.column;

          // Mettre à jour les 2 colonnes
          syncFromDOMToState(fromCol);
          syncFromDOMToState(toCol);
        }
      });
    });

    /* =========================================================
       7) AFFICHER / MASQUER DESCRIPTION (textarea)
       ========================================================= */
    document.querySelectorAll('.toggleBtn').forEach(btn => {
      btn.addEventListener('click', () => {
        const area = btn.closest('.trello-column').querySelector('.hidden-content');
        const visible = area.style.display === 'block';
        area.style.display = visible ? 'none' : 'block';
        // Tu peux changer le texte si tu veux :
        // btn.textContent = visible ? 'Afficher' : 'Masquer';
      });
    });

    /* =========================================================
       8) SAUVEGARDE EN TEMPS RÉEL DES TEXTAREA
       ========================================================= */
    document.querySelectorAll('.hidden-content').forEach(area => {
      area.addEventListener('input', () => {
        const colKey = area.closest('.trello-column').dataset.column;
        syncFromDOMToState(colKey);
      });
    });

    /* =========================================================
       9) BOUTON RETOUR
       - Tu avais dit de le mettre de côté, donc je ne touche pas.
       ========================================================= */
    document.getElementById('backBtn').addEventListener('click', () => {
      window.location.href = 'index.html';
    });

    /* =========================================================
       10) MODAL INFRASTRUCTURE
       - openModal(title, html)
       - closeModal()
       ========================================================= */
    const infoModalOverlay = document.getElementById('infoModalOverlay');
    const modalTitleEl = document.getElementById('modalTitle');
    const modalBodyEl  = document.getElementById('modalBody');
    const closeModalBtn = document.getElementById('closeModalBtn');

    function openModal(title, htmlBody) {
      modalTitleEl.textContent = title;
      modalBodyEl.innerHTML = htmlBody;
      infoModalOverlay.style.display = 'flex';
    }
    function closeModal() {
      infoModalOverlay.style.display = 'none';
      modalTitleEl.textContent = 'Fiche';
      modalBodyEl.innerHTML = '';
    }
    closeModalBtn.addEventListener('click', closeModal);
    infoModalOverlay.addEventListener('click', (e) => {
      if (e.target === infoModalOverlay) closeModal();
    });



/* ========= FICHE : Force========= */
/*function openforceModal() {
  const contentHTML = `
<h4>Stats</h4><pre> </pre>
<h4> mot </h4><div>  </div>
<h4> </pre>
<h4> </div>
  `.trim();
  openModal('force', contentHTML);
}
   /* ================== sauter de ligne restreint dans les paragraphe ======================= */

function minifyHTML(html) {
  return html
    .replace(/\n\s+/g, ' ')   // retire l’indentation
    .replace(/\s{2,}/g, ' ')  // compresse les espaces multiples
    .trim();
}


    /* =========================================================
       ✅ FIN
       - Tout est maintenant cohérent :
         - createCard() existe et gère les clics
         - plus de code "card.addEventListener" hors fonction
         - les races par défaut s’ajoutent automatiquement
         - les modals s’ouvrent correctement
       ========================================================= */
  </script>
</body>
</html>