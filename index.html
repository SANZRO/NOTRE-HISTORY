
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Wiki + Trello</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
 <link rel="stylesheet" href="./style/index.css">
  
</head>
<body>

  <!-- ==========================================================
       MODIF #Landing : Scène de garde (ciel + nuages + herbe + marcheur)
       ========================================================== -->
  <div id="landingScene" aria-hidden="true">
    <div class="sky"></div>
    <!-- Nuages -->
    <div class="cloud c1"></div>
    <div class="cloud c2"></div>
    <div class="cloud c3"></div>
    <div class="cloud c4"></div>
    <!-- Herbe -->
    <div class="grass"></div>
    <!-- Marcheur -->
    <div class="walker">
      <div class="man">
        <div class="head"></div>
        <div class="torso"></div>
        <div class="arm left"></div>
        <div class="arm right"></div>
        <div class="leg left"></div>
        <div class="leg right"></div>
      </div>
    </div>
  </div>

  <!-- Ciel étoilé (post-login) -->
  <div id="bgStars" aria-hidden="true">
    <div id="meteorOne"></div>
  </div>

  <!-- Formulaire de connexion -->
  <div class="login-form">
    <h2>Connexion</h2>
    <form id="loginForm">
      <input type="text" id="username" placeholder="Nom d'utilisateur" required>
      <input type="password" id="password" placeholder="Mot de passe" required>
      <button type="submit">Se connecter</button>
      <button type="button" id="resetBtn">Réinitialiser / Créer un utilisateur</button>
    </form>
  </div>

  <!-- Contenu du wiki (affiché après connexion) -->
  <div id="wikiContent">
    <h2 id="welcomeMsg">Bienvenue dans le wiki de notre history</h2>

    <h3>Ajouter un article</h3>
    <form id="articleForm">
      <input type="text" id="title" placeholder="Titre de l'article" required>
      <textarea id="body" rows="4" placeholder="Contenu de l'article" required></textarea>
      <button type="submit">Publier</button>
    </form>

    <div id="articles"></div>

    <!-- Mini Trello -->
    <div id="trelloBoard">
      <h2>Tableau Trello</h2>
      <div id="trelloColumns">
        <!-- Kanban classique -->
        <div class="trello-column" data-column="todo">
          <h3>À faire</h3>
          <div class="trello-list"></div>
          <button type="button" class="addCardBtn">+ Ajouter une carte</button>
        </div>
        <div class="trello-column" data-column="doing">
          <h3>En cours</h3>
          <div class="trello-list"></div>
          <button type="button" class="addCardBtn">+ Ajouter une carte</button>
        </div>
        <div class="trello-column" data-column="done">
          <h3>Terminé</h3>
          <div class="trello-list"></div>
          <button type="button" class="addCardBtn">+ Ajouter une carte</button>
        </div>

      <!-- Bouton pour nouvelle page -->
      <div style="margin-top:20px; text-align:center;">
        <button id="newPageBtn" style="padding:10px 20px; background:#2196f3; color:#fff; border:none; border-radius:6px; cursor:pointer;">
          Aller à la nouvelle page
        </button>
      </div>
    </div>
  </div>

  <script>
    /* ==========================================================
       Comptes utilisateurs avec persistance (localStorage)
       ========================================================== */
    const STORAGE_KEY_USERS = 'demo_wiki_users_v2';
    const DEFAULT_USERS = { admin: 'password', sanz: 'Sanzro', TEST: 'TEST' };

    function loadUsers() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY_USERS);
        if (raw) return { ...DEFAULT_USERS, ...JSON.parse(raw) };
      } catch (e) { console.warn('Lecture localStorage:', e); }
      return { ...DEFAULT_USERS };
    }
    function saveUsers(obj) {
      try { localStorage.setItem(STORAGE_KEY_USERS, JSON.stringify(obj)); }
      catch (e) { console.warn('Écriture localStorage:', e); }
    }
    let users = loadUsers();

    /* ==========================================================
       Scènes (garde / étoilée)
       ========================================================== */
    const landingScene = document.getElementById('landingScene');
    const bgStars      = document.getElementById('bgStars');

    function showLanding() { landingScene.style.display = 'block'; bgStars.style.display = 'none'; }
    function showStars()   { landingScene.style.display = 'none';  bgStars.style.display = 'block'; }

    // Génère N étoiles à des positions aléatoires avec animation "twinkle"
    function generateStars(count = 120) {
      bgStars.querySelectorAll('.star').forEach(s => s.remove());
      for (let i = 0; i < count; i++) {
        const star = document.createElement('div');
        star.className = 'star';
        const size = Math.random() < 0.85 ? 2 : 3;
        star.style.width  = size + 'px';
        star.style.height = size + 'px';
        star.style.left   = (Math.random() * 100) + 'vw';
        star.style.top    = (Math.random() * 100) + 'vh';
        star.style.animationDuration = (1.6 + Math.random() * 2.4) + 's';
        star.style.animationDelay    = (Math.random() * 2) + 's';
        bgStars.appendChild(star);
      }
      const meteor = document.getElementById('meteorOne');
      if (meteor) meteor.style.animationDelay = (Math.random() * 3) + 's';
    }

    // Affiche la page de garde au chargement
    document.addEventListener('DOMContentLoaded', showLanding);

    /* ==========================================================
       Connexion
       ========================================================== */
    document.getElementById('loginForm').addEventListener('submit', function(event) {
      event.preventDefault();

      const username = (document.getElementById('username').value || '').trim();
      const password = document.getElementById('password').value;

      if (!username) { alert('Veuillez entrer un nom d\'utilisateur.'); return; }

      const expected = users[username];
      if (expected && password === expected) {
        document.querySelector('.login-form').style.display = 'none';
        document.getElementById('wikiContent').style.display = 'block';

        // Message de bienvenue
        document.getElementById('welcomeMsg').textContent =
          `Bienvenue dans le wiki de notre history, ${username} !`;

        // Passe au ciel étoilé
        showStars();
        generateStars(140);

        // Affiche le Trello
        document.getElementById('trelloBoard').style.display = 'block';

        document.getElementById('username').value = '';
        document.getElementById('password').value = '';
      } else {
        alert('Nom d\'utilisateur ou mot de passe incorrect.');
      }
    });

    /* ==========================================================
       Réinitialisation protégée (code admin 1971)
       ========================================================== */
    document.getElementById('resetBtn').addEventListener('click', function() {
      const adminCode = prompt("Entrez le code administrateur :");
      if (adminCode !== "1971") { alert("Code incorrect. Accès refusé."); return; }

      const uname = (prompt('Entrez le nom d\'utilisateur à réinitialiser :') || '').trim();
      if (!uname) { alert('Réinitialisation annulée.'); return; }

      if (!users.hasOwnProperty(uname)) {
        const create = confirm(`L'utilisateur "${uname}" n'existe pas. Voulez-vous le créer ?`);
        if (!create) return;
      }

      const newPwd = prompt(`Entrez le nouveau mot de passe pour "${uname}" :`);
      if (!newPwd) { alert('Réinitialisation annulée.'); return; }

      users[uname] = newPwd;
      saveUsers(users);
      alert(`Mot de passe mis à jour pour "${uname}".`);
    });

    /* ==========================================================
       Articles
       ========================================================== */
    document.getElementById('articleForm').addEventListener('submit', function(event) {
      event.preventDefault();

      const title = (document.getElementById('title').value || '').trim();
      const body  = (document.getElementById('body').value  || '').trim();

      if (!title || !body) { alert('Veuillez renseigner le titre et le contenu.'); return; }

      const articleDiv = document.createElement('div');
      articleDiv.className = 'article';

      const h3 = document.createElement('h3'); h3.textContent = title;
      const p  = document.createElement('p');  p.textContent  = body;

      articleDiv.appendChild(h3);
      articleDiv.appendChild(p);
      document.getElementById('articles').appendChild(articleDiv);

      document.getElementById('title').value = '';
      document.getElementById('body').value  = '';
    });

    /* ==========================================================
       Mini Trello (cartes + drag&drop + catégories)
       ========================================================== */
    let draggedCard = null;

    function createCard(text) {
      const card = document.createElement('div');
      card.className = 'trello-card';
      card.textContent = text;
      card.draggable = true;

      card.addEventListener('dragstart', () => { draggedCard = card; card.style.opacity = '0.5'; });
      card.addEventListener('dragend',   () => { draggedCard = null; card.style.opacity = '1'; });

      return card;
    }

    document.querySelectorAll('.addCardBtn').forEach(btn => {
      btn.addEventListener('click', () => {
        const text = prompt('Nom de la carte :');
        if (!text) return;
        const list = btn.parentElement.querySelector('.trello-list');
        list.appendChild(createCard(text));
      });
    });

    document.querySelectorAll('.trello-list').forEach(list => {
      list.addEventListener('dragover', e => e.preventDefault());
      list.addEventListener('drop', () => { if (draggedCard) list.appendChild(draggedCard); });
    });

    // Boutons Afficher/Masquer pour les colonnes catégories
    document.querySelectorAll('.toggleBtn').forEach(btn => {
      btn.addEventListener('click', () => {
        const area = btn.parentElement.querySelector('.hidden-content');
        if (!area) return;
        const visible = area.style.display === 'block';
        area.style.display = visible ? 'none' : 'block';
        btn.textContent = visible ? 'Afficher' : 'Masquer';
      });
    });

    // Bouton "Aller à la nouvelle page"
    document.getElementById('newPageBtn').addEventListener('click', () => {
      // Change l’URL selon ta cible
      window.location.href = 'notre_histoire.html';
    });
  </script>
</body>
</html>
